<!DOCTYPE html>
<html>
<head>
    <title>Process Video</title>
    <style>
        body { font-family: Arial; background: #f0f0f0; padding: 2rem; }
        form { background: white; padding: 2rem; border-radius: 10px; max-width: 700px; margin: auto; }
        label, select, input, textarea { display: block; width: 100%; margin-bottom: 1rem; }
        textarea { height: 200px; font-family: monospace; }
        input[type="submit"] { background: #4CAF50; color: white; padding: 0.8rem; border: none; cursor: pointer; }
        .radio-container {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        }

        .radio-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        }
    </style>
</head>
<body>
    <form action="/process_video/" method="post">
        <h2>Step 2: Edit Transcription & Style</h2>
        
        <div class="radio-container">
            <div class="radio-option">
              <label for="mode_normal">Normal</label>
              <input type="radio" name="highlight_mode" value="false" id="mode_normal" checked onchange="toggleTranscriptionFields()">
            </div>
            <div class="radio-option">
              <label for="mode_highlight">Word-level</label>
              <input type="radio" name="highlight_mode" value="true" id="mode_highlight" onchange="toggleTranscriptionFields()">
            </div>
          </div>

        <!-- Textareas -->
        <div id="normal_input">
        <label for="srt_string">Transcription (SRT)</label>
        <textarea name="srt_string" id="srt_string">{{ transcription_text }}</textarea>
        </div>

        <div id="highlight_input" style="display: none;">
        <label for="srt_json">Transcription (JSON)</label>
        <textarea name="srt_json" id="srt_json">{{ transcription_json }}</textarea>
        </div>

        <label for="fontsize">Font size</label>
        <input type="number" name="fontsize" value="42">

        <label for="font">Font</label>
        <select id="font" name="font">
            <option>Loading fonts...</option>
        </select><br>

        <label for="bg_color">Background color</label>
        <input type="text" name="bg_color" value="#070a13b3">

        <label for="text_color">Text color</label>
        <select id="text_color" name="text_color">
            <option>Loading colors...</option>
        </select>

        <label for="caption_mode">Caption mode</label>
        <select name="caption_mode">
            <option value="desktop">Desktop</option>
            <option value="mobile">Mobile</option>
        </select>

        <input type="hidden" name="video_path" value="{{ video_path }}">
        <input type="hidden" name="temp_dir_path" value="{{ temp_dir_path }}">
        <input type="submit" value="Render & Download">
    </form>
    <div style="text-align: center; margin-top: 2em;">
        <a href="/transcribe_video">Transcribe Another Video</a>
    </div>
    <script>
    // Load dropdown options with optional default
    function populateDropdown(id, url, defaultValue = null) {
        fetch(url)
            .then(response => response.text())
            .then(data => {
                const select = document.getElementById(id);
                select.innerHTML = '';
                const lines = data.split('\n').map(x => x.trim()).filter(Boolean);

                lines.forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item;
                    opt.textContent = item;
                    if (item === defaultValue) {
                        opt.selected = true;
                    }
                    select.appendChild(opt);
                });
            })
            .catch(error => {
                console.error(`Error loading ${url}:`, error);
            });
    }

    // Set your default font and color here:
    const DEFAULT_FONT = "Helvetica";
    const DEFAULT_COLOR = "white";

    // Populate dropdowns with defaults
    populateDropdown('font', '/static/fonts.txt', DEFAULT_FONT);
    populateDropdown('text_color', '/static/colors.txt', DEFAULT_COLOR);
    function toggleTranscriptionFields() {
        const isHighlight = document.getElementById('mode_highlight').checked;
        document.getElementById('normal_input').style.display = isHighlight ? 'none' : 'block';
        document.getElementById('highlight_input').style.display = isHighlight ? 'block' : 'none';
    }
</script>
</body>
</html>
